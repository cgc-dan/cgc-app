"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _pluginBase = _interopRequireDefault(require("@electron-forge/plugin-base"));

var _webMultiLogger = _interopRequireDefault(require("@electron-forge/web-multi-logger"));

var _debug = _interopRequireDefault(require("debug"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _webpackMerge = _interopRequireDefault(require("webpack-merge"));

var _path = _interopRequireDefault(require("path"));

var _webpack = _interopRequireDefault(require("webpack"));

var _webpackHotMiddleware = _interopRequireDefault(require("webpack-hot-middleware"));

var _webpackDevMiddleware = _interopRequireDefault(require("webpack-dev-middleware"));

var _express = _interopRequireDefault(require("express"));

var _htmlWebpackPlugin = _interopRequireDefault(require("html-webpack-plugin"));

var _once = _interopRequireDefault(require("./util/once"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const d = (0, _debug.default)('electron-forge:plugin:webpack');
const DEFAULT_PORT = 3000;
const DEFAULT_LOGGER_PORT = 9000;

class WebpackPlugin extends _pluginBase.default {
  constructor(c) {
    super(c);

    _defineProperty(this, "name", 'webpack');

    _defineProperty(this, "isProd", false);

    _defineProperty(this, "projectDir", void 0);

    _defineProperty(this, "baseDir", void 0);

    _defineProperty(this, "watchers", []);

    _defineProperty(this, "servers", []);

    _defineProperty(this, "loggers", []);

    _defineProperty(this, "port", DEFAULT_PORT);

    _defineProperty(this, "loggerPort", DEFAULT_LOGGER_PORT);

    _defineProperty(this, "isValidPort", port => {
      if (port < 1024) {
        throw new Error(`Cannot specify port (${port}) below 1024, as they are privileged`);
      } else if (port > 65535) {
        throw new Error(`Port specified (${port}) is not a valid TCP port.`);
      } else {
        return true;
      }
    });

    _defineProperty(this, "resolveConfig", config => {
      // eslint-disable-next-line import/no-dynamic-require, global-require
      if (typeof config === 'string') return require(_path.default.resolve(_path.default.dirname(this.baseDir), config));
      return config;
    });

    _defineProperty(this, "exitHandler", (options, err) => {
      d('handling process exit with:', options);

      if (options.cleanup) {
        for (const watcher of this.watchers) {
          d('cleaning webpack watcher');
          watcher.close(() => {});
        }

        this.watchers = [];

        for (const server of this.servers) {
          d('cleaning http server');
          server.close();
        }

        this.servers = [];

        for (const logger of this.loggers) {
          d('stopping logger');
          logger.stop();
        }

        this.loggers = [];
      }

      if (err) console.error(err.stack);
      if (options.exit) process.exit();
    });

    _defineProperty(this, "runWebpack", async options => new Promise((resolve, reject) => {
      (0, _webpack.default)(options).run((err, stats) => {
        if (err) {
          return reject(err);
        }

        return resolve(stats);
      });
    }));

    _defineProperty(this, "init", dir => {
      this.projectDir = dir;
      this.baseDir = _path.default.resolve(dir, '.webpack');
      d('hooking process events');
      process.on('exit', _code => this.exitHandler({
        cleanup: true
      }));
      process.on('SIGINT', _signal => this.exitHandler({
        exit: true
      }));
    });

    _defineProperty(this, "loggedOutputUrl", false);

    _defineProperty(this, "resolveForgeConfig", async forgeConfig => {
      if (!forgeConfig.packagerConfig) {
        forgeConfig.packagerConfig = {};
      }

      if (forgeConfig.packagerConfig.ignore) {
        console.error(`You have set packagerConfig.ignore, the Electron Forge webpack plugin normally sets this automatically.

Your packaged app may be larger than expected if you dont ignore everything other than the '.webpack' folder`.red);
        return forgeConfig;
      }

      forgeConfig.packagerConfig.ignore = file => {
        if (!file) return false;
        return !/^[/\\]\.webpack($|[/\\]).*$/.test(file);
      };

      return forgeConfig;
    });

    _defineProperty(this, "packageAfterCopy", async (_, buildPath) => {
      const pj = await _fsExtra.default.readJson(_path.default.resolve(this.projectDir, 'package.json'));
      delete pj.config.forge;
      pj.devDependencies = {};
      pj.dependencies = {};
      pj.optionalDependencies = {};
      pj.peerDependencies = {};
      await _fsExtra.default.writeJson(_path.default.resolve(buildPath, 'package.json'), pj, {
        spaces: 2
      });
      await _fsExtra.default.mkdirp(_path.default.resolve(buildPath, 'node_modules'));
    });

    _defineProperty(this, "rendererEntryPoint", (entryPoint, inRendererDir, basename) => {
      if (this.isProd) {
        return `\`file://$\{require('path').resolve(__dirname, '..', '${inRendererDir ? 'renderer' : '.'}', '${entryPoint.name}', '${basename}')}\``;
      }

      const baseUrl = `http://localhost:${this.port}/${entryPoint.name}`;

      if (basename !== 'index.html') {
        return `'${baseUrl}/${basename}'`;
      }

      return `'${baseUrl}'`;
    });

    _defineProperty(this, "toEnvironmentVariable", (entryPoint, preload = false) => {
      const suffix = preload ? '_PRELOAD_WEBPACK_ENTRY' : '_WEBPACK_ENTRY';
      return `${entryPoint.name.toUpperCase().replace(/ /g, '_')}${suffix}`;
    });

    _defineProperty(this, "getPreloadDefine", entryPoint => {
      if (entryPoint.preload) {
        if (this.isProd) {
          return `require('path').resolve(__dirname, '../renderer', '${entryPoint.name}', 'preload.js')`;
        }

        return `'${_path.default.resolve(this.baseDir, 'renderer', entryPoint.name, 'preload.js').replace(/\\/g, '\\\\')}'`;
      } // If this entry-point has no configured preload script just map this constant to `undefined`
      // so that any code using it still works.  This makes quick-start / docs simpler.


      return 'undefined';
    });

    _defineProperty(this, "getDefines", (inRendererDir = true) => {
      const defines = {
        ASSET_RELOCATOR_BASE_DIR: this.isProd ? `process.resourcesPath + "/" + (__filename.indexOf(".asar") === -1 ? "app" : "app.asar") + "/.webpack/${inRendererDir ? 'main' : 'renderer/any_folder'}"` : JSON.stringify(_path.default.resolve(this.baseDir, inRendererDir ? 'main' : 'renderer', inRendererDir ? '.' : 'any_folder'))
      };

      if (!this.config.renderer.entryPoints || !Array.isArray(this.config.renderer.entryPoints)) {
        throw new Error('Required config option "renderer.entryPoints" has not been defined');
      }

      for (const entryPoint of this.config.renderer.entryPoints) {
        const entryKey = this.toEnvironmentVariable(entryPoint);

        if (entryPoint.html) {
          defines[entryKey] = this.rendererEntryPoint(entryPoint, inRendererDir, 'index.html');
        } else {
          defines[entryKey] = this.rendererEntryPoint(entryPoint, inRendererDir, 'index.js');
        }

        defines[`process.env.${entryKey}`] = defines[entryKey];
        const preloadDefineKey = this.toEnvironmentVariable(entryPoint, true);
        defines[preloadDefineKey] = this.getPreloadDefine(entryPoint);
        defines[`process.env.${preloadDefineKey}`] = defines[preloadDefineKey];
      }

      return defines;
    });

    _defineProperty(this, "getMainConfig", async () => {
      const mainConfig = this.resolveConfig(this.config.mainConfig);

      if (!mainConfig.entry) {
        throw new Error('Required config option "entry" has not been defined');
      }

      const fix = item => {
        if (typeof item === 'string') return fix([item])[0];

        if (Array.isArray(item)) {
          return item.map(val => {
            if (val.indexOf('./') === 0) return _path.default.resolve(this.projectDir, val);
            return val;
          });
        }

        const ret = {};

        for (const key of Object.keys(item)) {
          ret[key] = fix(item[key]);
        }

        return ret;
      };

      mainConfig.entry = fix(mainConfig.entry);
      const defines = this.getDefines();
      return _webpackMerge.default.smart({
        devtool: 'source-map',
        target: 'electron-main',
        mode: this.isProd ? 'production' : 'development',
        output: {
          path: _path.default.resolve(this.baseDir, 'main'),
          filename: 'index.js',
          libraryTarget: 'commonjs2'
        },
        plugins: [new _webpack.default.DefinePlugin(defines)],
        node: {
          __dirname: false,
          __filename: false
        },
        resolve: {
          modules: [_path.default.resolve(_path.default.dirname(this.baseDir), './'), _path.default.resolve(_path.default.dirname(this.baseDir), 'node_modules'), _path.default.resolve(__dirname, '..', 'node_modules')]
        }
      }, mainConfig || {});
    });

    _defineProperty(this, "getPreloadRendererConfig", async (parentPoint, entryPoint) => {
      const rendererConfig = this.resolveConfig(this.config.renderer.config);
      const prefixedEntries = entryPoint.prefixedEntries || [];
      return _webpackMerge.default.smart({
        devtool: 'inline-source-map',
        target: 'electron-renderer',
        mode: this.isProd ? 'production' : 'development',
        entry: prefixedEntries.concat([entryPoint.js]),
        output: {
          path: _path.default.resolve(this.baseDir, 'renderer', parentPoint.name),
          filename: 'preload.js'
        },
        node: {
          __dirname: false,
          __filename: false
        }
      }, rendererConfig);
    });

    _defineProperty(this, "getRendererConfig", async entryPoints => {
      const rendererConfig = this.resolveConfig(this.config.renderer.config);
      const entry = {};

      for (const entryPoint of entryPoints) {
        const prefixedEntries = entryPoint.prefixedEntries || [];
        entry[entryPoint.name] = prefixedEntries.concat([entryPoint.js]).concat(this.isProd || !entryPoint.html ? [] : ['webpack-hot-middleware/client']);
      }

      const defines = this.getDefines(false);
      return _webpackMerge.default.smart({
        entry,
        devtool: 'inline-source-map',
        target: 'electron-renderer',
        mode: this.isProd ? 'production' : 'development',
        output: _objectSpread({
          path: _path.default.resolve(this.baseDir, 'renderer'),
          filename: '[name]/index.js',
          globalObject: 'self'
        }, this.isProd ? {} : {
          publicPath: '/'
        }),
        node: {
          __dirname: false,
          __filename: false
        },
        plugins: entryPoints.filter(entryPoint => Boolean(entryPoint.html)).map(entryPoint => new _htmlWebpackPlugin.default({
          title: entryPoint.name,
          template: entryPoint.html,
          filename: `${entryPoint.name}/index.html`,
          chunks: [entryPoint.name].concat(entryPoint.additionalChunks || [])
        })).concat([new _webpack.default.DefinePlugin(defines)]).concat(this.isProd ? [] : [new _webpack.default.HotModuleReplacementPlugin()])
      }, rendererConfig);
    });

    _defineProperty(this, "compileMain", async (watch = false, logger) => {
      let tab;

      if (logger) {
        tab = logger.createTab('Main Process');
      }

      await (0, _asyncOra.asyncOra)('Compiling Main Process Code', async () => {
        const config = await this.getMainConfig();
        await new Promise((resolve, reject) => {
          const compiler = (0, _webpack.default)(config);
          const [onceResolve, onceReject] = (0, _once.default)(resolve, reject);

          const cb = (err, stats) => {
            if (tab && stats) {
              tab.log(stats.toString({
                colors: true
              }));
            }

            if (err) return onceReject(err);

            if (!watch && stats.hasErrors()) {
              return onceReject(new Error(`Compilation errors in the main process: ${stats.toString()}`));
            }

            return onceResolve();
          };

          if (watch) {
            this.watchers.push(compiler.watch({}, cb));
          } else {
            compiler.run(cb);
          }
        });
      });
    });

    _defineProperty(this, "compileRenderers", async (watch = false) => {
      // eslint-disable-line @typescript-eslint/no-unused-vars, max-len
      await (0, _asyncOra.asyncOra)('Compiling Renderer Template', async () => {
        const stats = await this.runWebpack((await this.getRendererConfig(this.config.renderer.entryPoints)));

        if (!watch && stats.hasErrors()) {
          throw new Error(`Compilation errors in the renderer: ${stats.toString()}`);
        }
      });

      for (const entryPoint of this.config.renderer.entryPoints) {
        if (entryPoint.preload) {
          await (0, _asyncOra.asyncOra)(`Compiling Renderer Preload: ${entryPoint.name}`, async () => {
            await this.runWebpack((await this.getPreloadRendererConfig(entryPoint, entryPoint.preload)));
          });
        }
      }
    });

    _defineProperty(this, "launchDevServers", async logger => {
      await (0, _asyncOra.asyncOra)('Launch Dev Servers', async () => {
        const tab = logger.createTab('Renderers');
        const config = await this.getRendererConfig(this.config.renderer.entryPoints);
        const compiler = (0, _webpack.default)(config);
        const server = (0, _webpackDevMiddleware.default)(compiler, {
          logger: {
            debug: tab.log.bind(tab),
            log: tab.log.bind(tab),
            info: tab.log.bind(tab),
            error: tab.log.bind(tab),
            warn: tab.log.bind(tab)
          },
          publicPath: '/',
          hot: true,
          historyApiFallback: true,
          writeToDisk: true
        });
        const app = (0, _express.default)();
        app.use(server);
        app.use((0, _webpackHotMiddleware.default)(compiler));
        this.servers.push(app.listen(this.port));
      });
      await (0, _asyncOra.asyncOra)('Compiling Preload Scripts', async () => {
        for (const entryPoint of this.config.renderer.entryPoints) {
          if (entryPoint.preload) {
            const config = await this.getPreloadRendererConfig(entryPoint, entryPoint.preload);
            await new Promise((resolve, reject) => {
              const tab = logger.createTab(`${entryPoint.name} - Preload`);
              const [onceResolve, onceReject] = (0, _once.default)(resolve, reject);
              this.watchers.push((0, _webpack.default)(config).watch({}, (err, stats) => {
                if (stats) {
                  tab.log(stats.toString({
                    colors: true
                  }));
                }

                if (err) return onceReject(err);
                return onceResolve();
              }));
            });
          }
        }
      });
    });

    _defineProperty(this, "alreadyStarted", false);

    if (c.port) {
      if (this.isValidPort(c.port)) {
        this.port = c.port;
      }
    }

    if (c.loggerPort) {
      if (this.isValidPort(c.loggerPort)) {
        this.loggerPort = c.loggerPort;
      }
    }

    this.startLogic = this.startLogic.bind(this);
    this.getHook = this.getHook.bind(this);
  }

  getHook(name) {
    switch (name) {
      case 'prePackage':
        this.isProd = true;
        return async () => {
          await _fsExtra.default.remove(this.baseDir);
          await this.compileMain();
          await this.compileRenderers();
        };

      case 'postStart':
        return async (_, child) => {
          if (!this.loggedOutputUrl) {
            console.info(`\n\nWebpack Output Available: ${`http://localhost:${this.loggerPort}`.cyan}\n`);
            this.loggedOutputUrl = true;
          }

          d('hooking electron process exit');
          child.on('exit', () => {
            if (child.restarted) return;
            this.exitHandler({
              cleanup: true,
              exit: true
            });
          });
        };

      case 'resolveForgeConfig':
        return this.resolveForgeConfig;

      case 'packageAfterCopy':
        return this.packageAfterCopy;

      default:
        return null;
    }
  }

  async startLogic() {
    if (this.alreadyStarted) return false;
    this.alreadyStarted = true;
    await _fsExtra.default.remove(this.baseDir);
    const logger = new _webMultiLogger.default(this.loggerPort);
    this.loggers.push(logger);
    await this.compileMain(true, logger);
    await this.launchDevServers(logger);
    await logger.start();
    return false;
  }

}

exports.default = WebpackPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9XZWJwYWNrUGx1Z2luLnRzIl0sIm5hbWVzIjpbImQiLCJERUZBVUxUX1BPUlQiLCJERUZBVUxUX0xPR0dFUl9QT1JUIiwiV2VicGFja1BsdWdpbiIsIlBsdWdpbkJhc2UiLCJjb25zdHJ1Y3RvciIsImMiLCJwb3J0IiwiRXJyb3IiLCJjb25maWciLCJyZXF1aXJlIiwicGF0aCIsInJlc29sdmUiLCJkaXJuYW1lIiwiYmFzZURpciIsIm9wdGlvbnMiLCJlcnIiLCJjbGVhbnVwIiwid2F0Y2hlciIsIndhdGNoZXJzIiwiY2xvc2UiLCJzZXJ2ZXIiLCJzZXJ2ZXJzIiwibG9nZ2VyIiwibG9nZ2VycyIsInN0b3AiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGFjayIsImV4aXQiLCJwcm9jZXNzIiwiUHJvbWlzZSIsInJlamVjdCIsInJ1biIsInN0YXRzIiwiZGlyIiwicHJvamVjdERpciIsIm9uIiwiX2NvZGUiLCJleGl0SGFuZGxlciIsIl9zaWduYWwiLCJmb3JnZUNvbmZpZyIsInBhY2thZ2VyQ29uZmlnIiwiaWdub3JlIiwicmVkIiwiZmlsZSIsInRlc3QiLCJfIiwiYnVpbGRQYXRoIiwicGoiLCJmcyIsInJlYWRKc29uIiwiZm9yZ2UiLCJkZXZEZXBlbmRlbmNpZXMiLCJkZXBlbmRlbmNpZXMiLCJvcHRpb25hbERlcGVuZGVuY2llcyIsInBlZXJEZXBlbmRlbmNpZXMiLCJ3cml0ZUpzb24iLCJzcGFjZXMiLCJta2RpcnAiLCJlbnRyeVBvaW50IiwiaW5SZW5kZXJlckRpciIsImJhc2VuYW1lIiwiaXNQcm9kIiwibmFtZSIsImJhc2VVcmwiLCJwcmVsb2FkIiwic3VmZml4IiwidG9VcHBlckNhc2UiLCJyZXBsYWNlIiwiZGVmaW5lcyIsIkFTU0VUX1JFTE9DQVRPUl9CQVNFX0RJUiIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZW5kZXJlciIsImVudHJ5UG9pbnRzIiwiQXJyYXkiLCJpc0FycmF5IiwiZW50cnlLZXkiLCJ0b0Vudmlyb25tZW50VmFyaWFibGUiLCJodG1sIiwicmVuZGVyZXJFbnRyeVBvaW50IiwicHJlbG9hZERlZmluZUtleSIsImdldFByZWxvYWREZWZpbmUiLCJtYWluQ29uZmlnIiwicmVzb2x2ZUNvbmZpZyIsImVudHJ5IiwiZml4IiwiaXRlbSIsIm1hcCIsInZhbCIsImluZGV4T2YiLCJyZXQiLCJrZXkiLCJPYmplY3QiLCJrZXlzIiwiZ2V0RGVmaW5lcyIsIm1lcmdlIiwic21hcnQiLCJkZXZ0b29sIiwidGFyZ2V0IiwibW9kZSIsIm91dHB1dCIsImZpbGVuYW1lIiwibGlicmFyeVRhcmdldCIsInBsdWdpbnMiLCJ3ZWJwYWNrIiwiRGVmaW5lUGx1Z2luIiwibm9kZSIsIl9fZGlybmFtZSIsIl9fZmlsZW5hbWUiLCJtb2R1bGVzIiwicGFyZW50UG9pbnQiLCJyZW5kZXJlckNvbmZpZyIsInByZWZpeGVkRW50cmllcyIsImNvbmNhdCIsImpzIiwiZ2xvYmFsT2JqZWN0IiwicHVibGljUGF0aCIsImZpbHRlciIsIkJvb2xlYW4iLCJIdG1sV2VicGFja1BsdWdpbiIsInRpdGxlIiwidGVtcGxhdGUiLCJjaHVua3MiLCJhZGRpdGlvbmFsQ2h1bmtzIiwiSG90TW9kdWxlUmVwbGFjZW1lbnRQbHVnaW4iLCJ3YXRjaCIsInRhYiIsImNyZWF0ZVRhYiIsImdldE1haW5Db25maWciLCJjb21waWxlciIsIm9uY2VSZXNvbHZlIiwib25jZVJlamVjdCIsImNiIiwibG9nIiwidG9TdHJpbmciLCJjb2xvcnMiLCJoYXNFcnJvcnMiLCJwdXNoIiwicnVuV2VicGFjayIsImdldFJlbmRlcmVyQ29uZmlnIiwiZ2V0UHJlbG9hZFJlbmRlcmVyQ29uZmlnIiwiZGVidWciLCJiaW5kIiwiaW5mbyIsIndhcm4iLCJob3QiLCJoaXN0b3J5QXBpRmFsbGJhY2siLCJ3cml0ZVRvRGlzayIsImFwcCIsInVzZSIsImxpc3RlbiIsImlzVmFsaWRQb3J0IiwibG9nZ2VyUG9ydCIsInN0YXJ0TG9naWMiLCJnZXRIb29rIiwicmVtb3ZlIiwiY29tcGlsZU1haW4iLCJjb21waWxlUmVuZGVyZXJzIiwiY2hpbGQiLCJsb2dnZWRPdXRwdXRVcmwiLCJjeWFuIiwicmVzdGFydGVkIiwicmVzb2x2ZUZvcmdlQ29uZmlnIiwicGFja2FnZUFmdGVyQ29weSIsImFscmVhZHlTdGFydGVkIiwiTG9nZ2VyIiwibGF1bmNoRGV2U2VydmVycyIsInN0YXJ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFFQTs7Ozs7Ozs7OztBQUdBLE1BQU1BLENBQUMsR0FBRyxvQkFBTSwrQkFBTixDQUFWO0FBQ0EsTUFBTUMsWUFBWSxHQUFHLElBQXJCO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsSUFBNUI7O0FBSWUsTUFBTUMsYUFBTixTQUE0QkMsbUJBQTVCLENBQTREO0FBbUJ6RUMsRUFBQUEsV0FBVyxDQUFDQyxDQUFELEVBQXlCO0FBQ2xDLFVBQU1BLENBQU47O0FBRGtDLGtDQWxCN0IsU0FrQjZCOztBQUFBLG9DQWhCbkIsS0FnQm1COztBQUFBOztBQUFBOztBQUFBLHNDQVZZLEVBVVo7O0FBQUEscUNBUkgsRUFRRzs7QUFBQSxxQ0FOUixFQU1ROztBQUFBLGtDQUpyQkwsWUFJcUI7O0FBQUEsd0NBRmZDLG1CQUVlOztBQUFBLHlDQWtCYkssSUFBRCxJQUFrQjtBQUN0QyxVQUFJQSxJQUFJLEdBQUcsSUFBWCxFQUFpQjtBQUNmLGNBQU0sSUFBSUMsS0FBSixDQUFXLHdCQUF1QkQsSUFBSyxzQ0FBdkMsQ0FBTjtBQUNELE9BRkQsTUFFTyxJQUFJQSxJQUFJLEdBQUcsS0FBWCxFQUFrQjtBQUN2QixjQUFNLElBQUlDLEtBQUosQ0FBVyxtQkFBa0JELElBQUssNEJBQWxDLENBQU47QUFDRCxPQUZNLE1BRUE7QUFDTCxlQUFPLElBQVA7QUFDRDtBQUNGLEtBMUJtQzs7QUFBQSwyQ0E0QlhFLE1BQUQsSUFBb0M7QUFDMUQ7QUFDQSxVQUFJLE9BQU9BLE1BQVAsS0FBa0Is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LFVBQU1BLE1BQU0sQ0FBQ2tKLEtBQVAsRUFBTjtBQUNBLFdBQU8sS0FBUDtBQUNEOztBQXhjd0UiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgXCJuby1jb25zb2xlXCI6IFwib2ZmXCIgKi9cbmltcG9ydCB7IGFzeW5jT3JhIH0gZnJvbSAnQGVsZWN0cm9uLWZvcmdlL2FzeW5jLW9yYSc7XG5pbXBvcnQgUGx1Z2luQmFzZSBmcm9tICdAZWxlY3Ryb24tZm9yZ2UvcGx1Z2luLWJhc2UnO1xuaW1wb3J0IHsgRm9yZ2VDb25maWcgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcbmltcG9ydCBMb2dnZXIsIHsgVGFiIH0gZnJvbSAnQGVsZWN0cm9uLWZvcmdlL3dlYi1tdWx0aS1sb2dnZXInO1xuaW1wb3J0IHsgQ2hpbGRQcm9jZXNzIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBtZXJnZSBmcm9tICd3ZWJwYWNrLW1lcmdlJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHdlYnBhY2ssIHsgQ29uZmlndXJhdGlvbiB9IGZyb20gJ3dlYnBhY2snO1xuaW1wb3J0IHdlYnBhY2tIb3RNaWRkbGV3YXJlIGZyb20gJ3dlYnBhY2staG90LW1pZGRsZXdhcmUnO1xuaW1wb3J0IHdlYnBhY2tEZXZNaWRkbGV3YXJlIGZyb20gJ3dlYnBhY2stZGV2LW1pZGRsZXdhcmUnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgaHR0cCBmcm9tICdodHRwJztcblxuaW1wb3J0IEh0bWxXZWJwYWNrUGx1Z2luIGZyb20gJ2h0bWwtd2VicGFjay1wbHVnaW4nO1xuXG5pbXBvcnQgb25jZSBmcm9tICcuL3V0aWwvb25jZSc7XG5pbXBvcnQgeyBXZWJwYWNrUGx1Z2luQ29uZmlnLCBXZWJwYWNrUGx1Z2luRW50cnlQb2ludCwgV2VicGFja1ByZWxvYWRFbnRyeVBvaW50IH0gZnJvbSAnLi9Db25maWcnO1xuXG5jb25zdCBkID0gZGVidWcoJ2VsZWN0cm9uLWZvcmdlOnBsdWdpbjp3ZWJwYWNrJyk7XG5jb25zdCBERUZBVUxUX1BPUlQgPSAzMDAwO1xuY29uc3QgREVGQVVMVF9MT0dHRVJfUE9SVCA9IDkwMDA7XG5cbnR5cGUgRW50cnlUeXBlID0gc3RyaW5nIHwgc3RyaW5nW10gfCBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBzdHJpbmdbXT47XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdlYnBhY2tQbHVnaW4gZXh0ZW5kcyBQbHVnaW5CYXNlPFdlYnBhY2tQbHVnaW5Db25maWc+IHtcbiAgbmFtZSA9ICd3ZWJwYWNrJztcblxuICBwcml2YXRlIGlzUHJvZCA9IGZhbHNlO1xuXG4gIHByaXZhdGUgcHJvamVjdERpciE6IHN0cmluZztcblxuICBwcml2YXRlIGJhc2VEaXIhOiBzdHJpbmc7XG5cbiAgcHJpdmF0ZSB3YXRjaGVyczogd2VicGFjay5Db21waWxlci5XYXRjaGluZ1tdID0gW107XG5cbiAgcHJpdmF0ZSBzZXJ2ZXJzOiBodHRwLlNlcnZlcltdID0gW107XG5cbiAgcHJpdmF0ZSBsb2dnZXJzOiBMb2dnZXJbXSA9IFtdO1xuXG4gIHByaXZhdGUgcG9ydCA9IERFRkFVTFRfUE9SVDtcblxuICBwcml2YXRlIGxvZ2dlclBvcnQgPSBERUZBVUxUX0xPR0dFUl9QT1JUO1xuXG4gIGNvbnN0cnVjdG9yKGM6IFdlYnBhY2tQbHVnaW5Db25maWcpIHtcbiAgICBzdXBlcihjKTtcblxuICAgIGlmIChjLnBvcnQpIHtcbiAgICAgIGlmICh0aGlzLmlzVmFsaWRQb3J0KGMucG9ydCkpIHtcbiAgICAgICAgdGhpcy5wb3J0ID0gYy5wb3J0O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYy5sb2dnZXJQb3J0KSB7XG4gICAgICBpZiAodGhpcy5pc1ZhbGlkUG9ydChjLmxvZ2dlclBvcnQpKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyUG9ydCA9IGMubG9nZ2VyUG9ydDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnN0YXJ0TG9naWMgPSB0aGlzLnN0YXJ0TG9naWMuYmluZCh0aGlzKTtcbiAgICB0aGlzLmdldEhvb2sgPSB0aGlzLmdldEhvb2suYmluZCh0aGlzKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNWYWxpZFBvcnQgPSAocG9ydDogbnVtYmVyKSA9PiB7XG4gICAgaWYgKHBvcnQgPCAxMDI0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzcGVjaWZ5IHBvcnQgKCR7cG9ydH0pIGJlbG93IDEwMjQsIGFzIHRoZXkgYXJlIHByaXZpbGVnZWRgKTtcbiAgICB9IGVsc2UgaWYgKHBvcnQgPiA2NTUzNSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBQb3J0IHNwZWNpZmllZCAoJHtwb3J0fSkgaXMgbm90IGEgdmFsaWQgVENQIHBvcnQuYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVzb2x2ZUNvbmZpZyA9IChjb25maWc6IENvbmZpZ3VyYXRpb24gfCBzdHJpbmcpID0+IHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZSwgZ2xvYmFsLXJlcXVpcmVcbiAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHJldHVybiByZXF1aXJlKHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUodGhpcy5iYXNlRGlyKSwgY29uZmlnKSkgYXMgQ29uZmlndXJhdGlvbjtcbiAgICByZXR1cm4gY29uZmlnO1xuICB9XG5cbiAgcHJpdmF0ZSBleGl0SGFuZGxlciA9IChvcHRpb25zOiB7IGNsZWFudXA/OiBib29sZWFuOyBleGl0PzogYm9vbGVhbiB9LCBlcnI/OiBFcnJvcikgPT4ge1xuICAgIGQoJ2hhbmRsaW5nIHByb2Nlc3MgZXhpdCB3aXRoOicsIG9wdGlvbnMpO1xuICAgIGlmIChvcHRpb25zLmNsZWFudXApIHtcbiAgICAgIGZvciAoY29uc3Qgd2F0Y2hlciBvZiB0aGlzLndhdGNoZXJzKSB7XG4gICAgICAgIGQoJ2NsZWFuaW5nIHdlYnBhY2sgd2F0Y2hlcicpO1xuICAgICAgICB3YXRjaGVyLmNsb3NlKCgpID0+IHt9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMud2F0Y2hlcnMgPSBbXTtcbiAgICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIHRoaXMuc2VydmVycykge1xuICAgICAgICBkKCdjbGVhbmluZyBodHRwIHNlcnZlcicpO1xuICAgICAgICBzZXJ2ZXIuY2xvc2UoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2VydmVycyA9IFtdO1xuICAgICAgZm9yIChjb25zdCBsb2dnZXIgb2YgdGhpcy5sb2dnZXJzKSB7XG4gICAgICAgIGQoJ3N0b3BwaW5nIGxvZ2dlcicpO1xuICAgICAgICBsb2dnZXIuc3RvcCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2dnZXJzID0gW107XG4gICAgfVxuICAgIGlmIChlcnIpIGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKTtcbiAgICBpZiAob3B0aW9ucy5leGl0KSBwcm9jZXNzLmV4aXQoKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuXG4gIHByaXZhdGUgcnVuV2VicGFjayA9IGFzeW5jIChvcHRpb25zOiB3ZWJwYWNrLkNvbmZpZ3VyYXRpb24pOiBQcm9taXNlPHdlYnBhY2suU3RhdHM+ID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB3ZWJwYWNrKG9wdGlvbnMpXG4gICAgICAucnVuKChlcnIsIHN0YXRzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc3RhdHMpO1xuICAgICAgfSk7XG4gIH0pO1xuXG4gIGluaXQgPSAoZGlyOiBzdHJpbmcpID0+IHtcbiAgICB0aGlzLnByb2plY3REaXIgPSBkaXI7XG4gICAgdGhpcy5iYXNlRGlyID0gcGF0aC5yZXNvbHZlKGRpciwgJy53ZWJwYWNrJyk7XG5cbiAgICBkKCdob29raW5nIHByb2Nlc3MgZXZlbnRzJyk7XG4gICAgcHJvY2Vzcy5vbignZXhpdCcsIChfY29kZSkgPT4gdGhpcy5leGl0SGFuZGxlcih7IGNsZWFudXA6IHRydWUgfSkpO1xuICAgIHByb2Nlc3Mub24oJ1NJR0lOVCcgYXMgTm9kZUpTLlNpZ25hbHMsIChfc2lnbmFsKSA9PiB0aGlzLmV4aXRIYW5kbGVyKHsgZXhpdDogdHJ1ZSB9KSk7XG4gIH1cblxuICBwcml2YXRlIGxvZ2dlZE91dHB1dFVybCA9IGZhbHNlO1xuXG4gIGdldEhvb2sobmFtZTogc3RyaW5nKSB7XG4gICAgc3dpdGNoIChuYW1lKSB7XG4gICAgICBjYXNlICdwcmVQYWNrYWdlJzpcbiAgICAgICAgdGhpcy5pc1Byb2QgPSB0cnVlO1xuICAgICAgICByZXR1cm4gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGF3YWl0IGZzLnJlbW92ZSh0aGlzLmJhc2VEaXIpO1xuICAgICAgICAgIGF3YWl0IHRoaXMuY29tcGlsZU1haW4oKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNvbXBpbGVSZW5kZXJlcnMoKTtcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ3Bvc3RTdGFydCc6XG4gICAgICAgIHJldHVybiBhc3luYyAoXzogYW55LCBjaGlsZDogQ2hpbGRQcm9jZXNzKSA9PiB7XG4gICAgICAgICAgaWYgKCF0aGlzLmxvZ2dlZE91dHB1dFVybCkge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKGBcXG5cXG5XZWJwYWNrIE91dHB1dCBBdmFpbGFibGU6ICR7KGBodHRwOi8vbG9jYWxob3N0OiR7dGhpcy5sb2dnZXJQb3J0fWApLmN5YW59XFxuYCk7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlZE91dHB1dFVybCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGQoJ2hvb2tpbmcgZWxlY3Ryb24gcHJvY2VzcyBleGl0Jyk7XG4gICAgICAgICAgY2hpbGQub24oJ2V4aXQnLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoKGNoaWxkIGFzIGFueSkucmVzdGFydGVkKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmV4aXRIYW5kbGVyKHsgY2xlYW51cDogdHJ1ZSwgZXhpdDogdHJ1ZSB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ3Jlc29sdmVGb3JnZUNvbmZpZyc6XG4gICAgICAgIHJldHVybiB0aGlzLnJlc29sdmVGb3JnZUNvbmZpZztcbiAgICAgIGNhc2UgJ3BhY2thZ2VBZnRlckNvcHknOlxuICAgICAgICByZXR1cm4gdGhpcy5wYWNrYWdlQWZ0ZXJDb3B5O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcmVzb2x2ZUZvcmdlQ29uZmlnID0gYXN5bmMgKGZvcmdlQ29uZmlnOiBGb3JnZUNvbmZpZykgPT4ge1xuICAgIGlmICghZm9yZ2VDb25maWcucGFja2FnZXJDb25maWcpIHtcbiAgICAgIGZvcmdlQ29uZmlnLnBhY2thZ2VyQ29uZmlnID0ge307XG4gICAgfVxuICAgIGlmIChmb3JnZUNvbmZpZy5wYWNrYWdlckNvbmZpZy5pZ25vcmUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFlvdSBoYXZlIHNldCBwYWNrYWdlckNvbmZpZy5pZ25vcmUsIHRoZSBFbGVjdHJvbiBGb3JnZSB3ZWJwYWNrIHBsdWdpbiBub3JtYWxseSBzZXRzIHRoaXMgYXV0b21hdGljYWxseS5cblxuWW91ciBwYWNrYWdlZCBhcHAgbWF5IGJlIGxhcmdlciB0aGFuIGV4cGVjdGVkIGlmIHlvdSBkb250IGlnbm9yZSBldmVyeXRoaW5nIG90aGVyIHRoYW4gdGhlICcud2VicGFjaycgZm9sZGVyYC5yZWQpO1xuICAgICAgcmV0dXJuIGZvcmdlQ29uZmlnO1xuICAgIH1cbiAgICBmb3JnZUNvbmZpZy5wYWNrYWdlckNvbmZpZy5pZ25vcmUgPSAoZmlsZTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAoIWZpbGUpIHJldHVybiBmYWxzZTtcblxuICAgICAgcmV0dXJuICEvXlsvXFxcXF1cXC53ZWJwYWNrKCR8Wy9cXFxcXSkuKiQvLnRlc3QoZmlsZSk7XG4gICAgfTtcbiAgICByZXR1cm4gZm9yZ2VDb25maWc7XG4gIH1cblxuICBwYWNrYWdlQWZ0ZXJDb3B5ID0gYXN5bmMgKF86IGFueSwgYnVpbGRQYXRoOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBwaiA9IGF3YWl0IGZzLnJlYWRKc29uKHBhdGgucmVzb2x2ZSh0aGlzLnByb2plY3REaXIsICdwYWNrYWdlLmpzb24nKSk7XG4gICAgZGVsZXRlIHBqLmNvbmZpZy5mb3JnZTtcbiAgICBwai5kZXZEZXBlbmRlbmNpZXMgPSB7fTtcbiAgICBwai5kZXBlbmRlbmNpZXMgPSB7fTtcbiAgICBwai5vcHRpb25hbERlcGVuZGVuY2llcyA9IHt9O1xuICAgIHBqLnBlZXJEZXBlbmRlbmNpZXMgPSB7fTtcblxuICAgIGF3YWl0IGZzLndyaXRlSnNvbihcbiAgICAgIHBhdGgucmVzb2x2ZShidWlsZFBhdGgsICdwYWNrYWdlLmpzb24nKSxcbiAgICAgIHBqLFxuICAgICAge1xuICAgICAgICBzcGFjZXM6IDIsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICBhd2FpdCBmcy5ta2RpcnAocGF0aC5yZXNvbHZlKGJ1aWxkUGF0aCwgJ25vZGVfbW9kdWxlcycpKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbGVuXG4gIHJlbmRlcmVyRW50cnlQb2ludCA9IChlbnRyeVBvaW50OiBXZWJwYWNrUGx1Z2luRW50cnlQb2ludCwgaW5SZW5kZXJlckRpcjogYm9vbGVhbiwgYmFzZW5hbWU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgaWYgKHRoaXMuaXNQcm9kKSB7XG4gICAgICByZXR1cm4gYFxcYGZpbGU6Ly8kXFx7cmVxdWlyZSgncGF0aCcpLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nLCAnJHtpblJlbmRlcmVyRGlyID8gJ3JlbmRlcmVyJyA6ICcuJ30nLCAnJHtlbnRyeVBvaW50Lm5hbWV9JywgJyR7YmFzZW5hbWV9Jyl9XFxgYDtcbiAgICB9XG4gICAgY29uc3QgYmFzZVVybCA9IGBodHRwOi8vbG9jYWxob3N0OiR7dGhpcy5wb3J0fS8ke2VudHJ5UG9pbnQubmFtZX1gO1xuICAgIGlmIChiYXNlbmFtZSAhPT0gJ2luZGV4Lmh0bWwnKSB7XG4gICAgICByZXR1cm4gYCcke2Jhc2VVcmx9LyR7YmFzZW5hbWV9J2A7XG4gICAgfVxuICAgIHJldHVybiBgJyR7YmFzZVVybH0nYDtcbiAgfVxuXG4gIHRvRW52aXJvbm1lbnRWYXJpYWJsZSA9IChlbnRyeVBvaW50OiBXZWJwYWNrUGx1Z2luRW50cnlQb2ludCwgcHJlbG9hZCA9IGZhbHNlKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBzdWZmaXggPSBwcmVsb2FkID8gJ19QUkVMT0FEX1dFQlBBQ0tfRU5UUlknIDogJ19XRUJQQUNLX0VOVFJZJztcbiAgICByZXR1cm4gYCR7ZW50cnlQb2ludC5uYW1lLnRvVXBwZXJDYXNlKCkucmVwbGFjZSgvIC9nLCAnXycpfSR7c3VmZml4fWA7XG4gIH1cblxuICBnZXRQcmVsb2FkRGVmaW5lID0gKGVudHJ5UG9pbnQ6IFdlYnBhY2tQbHVnaW5FbnRyeVBvaW50KTogc3RyaW5nID0+IHtcbiAgICBpZiAoZW50cnlQb2ludC5wcmVsb2FkKSB7XG4gICAgICBpZiAodGhpcy5pc1Byb2QpIHtcbiAgICAgICAgcmV0dXJuIGByZXF1aXJlKCdwYXRoJykucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi9yZW5kZXJlcicsICcke2VudHJ5UG9pbnQubmFtZX0nLCAncHJlbG9hZC5qcycpYDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBgJyR7cGF0aC5yZXNvbHZlKHRoaXMuYmFzZURpciwgJ3JlbmRlcmVyJywgZW50cnlQb2ludC5uYW1lLCAncHJlbG9hZC5qcycpLnJlcGxhY2UoL1xcXFwvZywgJ1xcXFxcXFxcJyl9J2A7XG4gICAgfVxuICAgIC8vIElmIHRoaXMgZW50cnktcG9pbnQgaGFzIG5vIGNvbmZpZ3VyZWQgcHJlbG9hZCBzY3JpcHQganVzdCBtYXAgdGhpcyBjb25zdGFudCB0byBgdW5kZWZpbmVkYFxuICAgIC8vIHNvIHRoYXQgYW55IGNvZGUgdXNpbmcgaXQgc3RpbGwgd29ya3MuICBUaGlzIG1ha2VzIHF1aWNrLXN0YXJ0IC8gZG9jcyBzaW1wbGVyLlxuICAgIHJldHVybiAndW5kZWZpbmVkJztcbiAgfVxuXG4gIGdldERlZmluZXMgPSAoaW5SZW5kZXJlckRpciA9IHRydWUpID0+IHtcbiAgICBjb25zdCBkZWZpbmVzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcbiAgICAgIEFTU0VUX1JFTE9DQVRPUl9CQVNFX0RJUjogdGhpcy5pc1Byb2RcbiAgICAgICAgPyBgcHJvY2Vzcy5yZXNvdXJjZXNQYXRoICsgXCIvXCIgKyAoX19maWxlbmFtZS5pbmRleE9mKFwiLmFzYXJcIikgPT09IC0xID8gXCJhcHBcIiA6IFwiYXBwLmFzYXJcIikgKyBcIi8ud2VicGFjay8ke2luUmVuZGVyZXJEaXIgPyAnbWFpbicgOiAncmVuZGVyZXIvYW55X2ZvbGRlcid9XCJgXG4gICAgICAgIDogSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgdGhpcy5iYXNlRGlyLFxuICAgICAgICAgICAgaW5SZW5kZXJlckRpciA/ICdtYWluJyA6ICdyZW5kZXJlcicsXG4gICAgICAgICAgICBpblJlbmRlcmVyRGlyID8gJy4nIDogJ2FueV9mb2xkZXInLFxuICAgICAgICAgICksXG4gICAgICAgICksXG4gICAgfTtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnJlbmRlcmVyLmVudHJ5UG9pbnRzIHx8ICFBcnJheS5pc0FycmF5KHRoaXMuY29uZmlnLnJlbmRlcmVyLmVudHJ5UG9pbnRzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBjb25maWcgb3B0aW9uIFwicmVuZGVyZXIuZW50cnlQb2ludHNcIiBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGVudHJ5UG9pbnQgb2YgdGhpcy5jb25maWcucmVuZGVyZXIuZW50cnlQb2ludHMpIHtcbiAgICAgIGNvbnN0IGVudHJ5S2V5ID0gdGhpcy50b0Vudmlyb25tZW50VmFyaWFibGUoZW50cnlQb2ludCk7XG4gICAgICBpZiAoZW50cnlQb2ludC5odG1sKSB7XG4gICAgICAgIGRlZmluZXNbZW50cnlLZXldID0gdGhpcy5yZW5kZXJlckVudHJ5UG9pbnQoZW50cnlQb2ludCwgaW5SZW5kZXJlckRpciwgJ2luZGV4Lmh0bWwnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlZmluZXNbZW50cnlLZXldID0gdGhpcy5yZW5kZXJlckVudHJ5UG9pbnQoZW50cnlQb2ludCwgaW5SZW5kZXJlckRpciwgJ2luZGV4LmpzJyk7XG4gICAgICB9XG4gICAgICBkZWZpbmVzW2Bwcm9jZXNzLmVudi4ke2VudHJ5S2V5fWBdID0gZGVmaW5lc1tlbnRyeUtleV07XG5cbiAgICAgIGNvbnN0IHByZWxvYWREZWZpbmVLZXkgPSB0aGlzLnRvRW52aXJvbm1lbnRWYXJpYWJsZShlbnRyeVBvaW50LCB0cnVlKTtcbiAgICAgIGRlZmluZXNbcHJlbG9hZERlZmluZUtleV0gPSB0aGlzLmdldFByZWxvYWREZWZpbmUoZW50cnlQb2ludCk7XG4gICAgICBkZWZpbmVzW2Bwcm9jZXNzLmVudi4ke3ByZWxvYWREZWZpbmVLZXl9YF0gPSBkZWZpbmVzW3ByZWxvYWREZWZpbmVLZXldO1xuICAgIH1cbiAgICByZXR1cm4gZGVmaW5lcztcbiAgfVxuXG4gIGdldE1haW5Db25maWcgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbWFpbkNvbmZpZyA9IHRoaXMucmVzb2x2ZUNvbmZpZyh0aGlzLmNvbmZpZy5tYWluQ29uZmlnKTtcblxuICAgIGlmICghbWFpbkNvbmZpZy5lbnRyeSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1aXJlZCBjb25maWcgb3B0aW9uIFwiZW50cnlcIiBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xuICAgIH1cbiAgICBjb25zdCBmaXggPSAoaXRlbTogRW50cnlUeXBlKTogRW50cnlUeXBlID0+IHtcbiAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycpIHJldHVybiAoZml4KFtpdGVtXSkgYXMgc3RyaW5nW10pWzBdO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0ubWFwKCh2YWwpID0+IHtcbiAgICAgICAgICBpZiAodmFsLmluZGV4T2YoJy4vJykgPT09IDApIHJldHVybiBwYXRoLnJlc29sdmUodGhpcy5wcm9qZWN0RGlyLCB2YWwpO1xuICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgcmV0OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBzdHJpbmdbXT4gPSB7fTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGl0ZW0pKSB7XG4gICAgICAgIHJldFtrZXldID0gZml4KGl0ZW1ba2V5XSkgYXMgc3RyaW5nIHwgc3RyaW5nW107XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH07XG4gICAgbWFpbkNvbmZpZy5lbnRyeSA9IGZpeChtYWluQ29uZmlnLmVudHJ5IGFzIEVudHJ5VHlwZSk7XG5cbiAgICBjb25zdCBkZWZpbmVzID0gdGhpcy5nZXREZWZpbmVzKCk7XG4gICAgcmV0dXJuIG1lcmdlLnNtYXJ0KHtcbiAgICAgIGRldnRvb2w6ICdzb3VyY2UtbWFwJyxcbiAgICAgIHRhcmdldDogJ2VsZWN0cm9uLW1haW4nLFxuICAgICAgbW9kZTogdGhpcy5pc1Byb2QgPyAncHJvZHVjdGlvbicgOiAnZGV2ZWxvcG1lbnQnLFxuICAgICAgb3V0cHV0OiB7XG4gICAgICAgIHBhdGg6IHBhdGgucmVzb2x2ZSh0aGlzLmJhc2VEaXIsICdtYWluJyksXG4gICAgICAgIGZpbGVuYW1lOiAnaW5kZXguanMnLFxuICAgICAgICBsaWJyYXJ5VGFyZ2V0OiAnY29tbW9uanMyJyxcbiAgICAgIH0sXG4gICAgICBwbHVnaW5zOiBbXG4gICAgICAgIG5ldyB3ZWJwYWNrLkRlZmluZVBsdWdpbihkZWZpbmVzKSxcbiAgICAgIF0sXG4gICAgICBub2RlOiB7XG4gICAgICAgIF9fZGlybmFtZTogZmFsc2UsXG4gICAgICAgIF9fZmlsZW5hbWU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgbW9kdWxlczogW1xuICAgICAgICAgIHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUodGhpcy5iYXNlRGlyKSwgJy4vJyksXG4gICAgICAgICAgcGF0aC5yZXNvbHZlKHBhdGguZGlybmFtZSh0aGlzLmJhc2VEaXIpLCAnbm9kZV9tb2R1bGVzJyksXG4gICAgICAgICAgcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJ25vZGVfbW9kdWxlcycpLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9LCBtYWluQ29uZmlnIHx8IHt9KTtcbiAgfVxuXG4gIGdldFByZWxvYWRSZW5kZXJlckNvbmZpZyA9IGFzeW5jIChcbiAgICBwYXJlbnRQb2ludDogV2VicGFja1BsdWdpbkVudHJ5UG9pbnQsXG4gICAgZW50cnlQb2ludDogV2VicGFja1ByZWxvYWRFbnRyeVBvaW50LFxuICApID0+IHtcbiAgICBjb25zdCByZW5kZXJlckNvbmZpZyA9IHRoaXMucmVzb2x2ZUNvbmZpZyh0aGlzLmNvbmZpZy5yZW5kZXJlci5jb25maWcpO1xuICAgIGNvbnN0IHByZWZpeGVkRW50cmllcyA9IGVudHJ5UG9pbnQucHJlZml4ZWRFbnRyaWVzIHx8IFtdO1xuXG4gICAgcmV0dXJuIG1lcmdlLnNtYXJ0KHtcbiAgICAgIGRldnRvb2w6ICdpbmxpbmUtc291cmNlLW1hcCcsXG4gICAgICB0YXJnZXQ6ICdlbGVjdHJvbi1yZW5kZXJlcicsXG4gICAgICBtb2RlOiB0aGlzLmlzUHJvZCA/ICdwcm9kdWN0aW9uJyA6ICdkZXZlbG9wbWVudCcsXG4gICAgICBlbnRyeTogcHJlZml4ZWRFbnRyaWVzLmNvbmNhdChbXG4gICAgICAgIGVudHJ5UG9pbnQuanMsXG4gICAgICBdKSxcbiAgICAgIG91dHB1dDoge1xuICAgICAgICBwYXRoOiBwYXRoLnJlc29sdmUodGhpcy5iYXNlRGlyLCAncmVuZGVyZXInLCBwYXJlbnRQb2ludC5uYW1lKSxcbiAgICAgICAgZmlsZW5hbWU6ICdwcmVsb2FkLmpzJyxcbiAgICAgIH0sXG4gICAgICBub2RlOiB7XG4gICAgICAgIF9fZGlybmFtZTogZmFsc2UsXG4gICAgICAgIF9fZmlsZW5hbWU6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9LCByZW5kZXJlckNvbmZpZyk7XG4gIH1cblxuICBnZXRSZW5kZXJlckNvbmZpZyA9IGFzeW5jIChlbnRyeVBvaW50czogV2VicGFja1BsdWdpbkVudHJ5UG9pbnRbXSkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVyQ29uZmlnID0gdGhpcy5yZXNvbHZlQ29uZmlnKHRoaXMuY29uZmlnLnJlbmRlcmVyLmNvbmZpZyk7XG4gICAgY29uc3QgZW50cnk6IHdlYnBhY2suRW50cnkgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGVudHJ5UG9pbnQgb2YgZW50cnlQb2ludHMpIHtcbiAgICAgIGNvbnN0IHByZWZpeGVkRW50cmllcyA9IGVudHJ5UG9pbnQucHJlZml4ZWRFbnRyaWVzIHx8IFtdO1xuICAgICAgZW50cnlbZW50cnlQb2ludC5uYW1lXSA9IHByZWZpeGVkRW50cmllc1xuICAgICAgICAuY29uY2F0KFtlbnRyeVBvaW50LmpzXSlcbiAgICAgICAgLmNvbmNhdCh0aGlzLmlzUHJvZCB8fCAhZW50cnlQb2ludC5odG1sID8gW10gOiBbJ3dlYnBhY2staG90LW1pZGRsZXdhcmUvY2xpZW50J10pO1xuICAgIH1cblxuICAgIGNvbnN0IGRlZmluZXMgPSB0aGlzLmdldERlZmluZXMoZmFsc2UpO1xuICAgIHJldHVybiBtZXJnZS5zbWFydCh7XG4gICAgICBlbnRyeSxcbiAgICAgIGRldnRvb2w6ICdpbmxpbmUtc291cmNlLW1hcCcsXG4gICAgICB0YXJnZXQ6ICdlbGVjdHJvbi1yZW5kZXJlcicsXG4gICAgICBtb2RlOiB0aGlzLmlzUHJvZCA/ICdwcm9kdWN0aW9uJyA6ICdkZXZlbG9wbWVudCcsXG4gICAgICBvdXRwdXQ6IHtcbiAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKHRoaXMuYmFzZURpciwgJ3JlbmRlcmVyJyksXG4gICAgICAgIGZpbGVuYW1lOiAnW25hbWVdL2luZGV4LmpzJyxcbiAgICAgICAgZ2xvYmFsT2JqZWN0OiAnc2VsZicsXG4gICAgICAgIC4uLih0aGlzLmlzUHJvZCA/IHt9IDogeyBwdWJsaWNQYXRoOiAnLycgfSksXG4gICAgICB9LFxuICAgICAgbm9kZToge1xuICAgICAgICBfX2Rpcm5hbWU6IGZhbHNlLFxuICAgICAgICBfX2ZpbGVuYW1lOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBwbHVnaW5zOiBlbnRyeVBvaW50cy5maWx0ZXIoKGVudHJ5UG9pbnQpID0+IEJvb2xlYW4oZW50cnlQb2ludC5odG1sKSlcbiAgICAgICAgLm1hcCgoZW50cnlQb2ludCkgPT4gbmV3IEh0bWxXZWJwYWNrUGx1Z2luKHtcbiAgICAgICAgICB0aXRsZTogZW50cnlQb2ludC5uYW1lLFxuICAgICAgICAgIHRlbXBsYXRlOiBlbnRyeVBvaW50Lmh0bWwsXG4gICAgICAgICAgZmlsZW5hbWU6IGAke2VudHJ5UG9pbnQubmFtZX0vaW5kZXguaHRtbGAsXG4gICAgICAgICAgY2h1bmtzOiBbZW50cnlQb2ludC5uYW1lXS5jb25jYXQoZW50cnlQb2ludC5hZGRpdGlvbmFsQ2h1bmtzIHx8IFtdKSxcbiAgICAgICAgfSkpLmNvbmNhdChbbmV3IHdlYnBhY2suRGVmaW5lUGx1Z2luKGRlZmluZXMpXSlcbiAgICAgICAgLmNvbmNhdCh0aGlzLmlzUHJvZCA/IFtdIDogW25ldyB3ZWJwYWNrLkhvdE1vZHVsZVJlcGxhY2VtZW50UGx1Z2luKCldKSxcbiAgICB9LCByZW5kZXJlckNvbmZpZyk7XG4gIH1cblxuICBjb21waWxlTWFpbiA9IGFzeW5jICh3YXRjaCA9IGZhbHNlLCBsb2dnZXI/OiBMb2dnZXIpID0+IHtcbiAgICBsZXQgdGFiOiBUYWI7XG4gICAgaWYgKGxvZ2dlcikge1xuICAgICAgdGFiID0gbG9nZ2VyLmNyZWF0ZVRhYignTWFpbiBQcm9jZXNzJyk7XG4gICAgfVxuICAgIGF3YWl0IGFzeW5jT3JhKCdDb21waWxpbmcgTWFpbiBQcm9jZXNzIENvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSBhd2FpdCB0aGlzLmdldE1haW5Db25maWcoKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgY29tcGlsZXIgPSB3ZWJwYWNrKGNvbmZpZyk7XG4gICAgICAgIGNvbnN0IFtvbmNlUmVzb2x2ZSwgb25jZVJlamVjdF0gPSBvbmNlKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIGNvbnN0IGNiOiB3ZWJwYWNrLklDb21waWxlci5IYW5kbGVyID0gKGVyciwgc3RhdHMpID0+IHtcbiAgICAgICAgICBpZiAodGFiICYmIHN0YXRzKSB7XG4gICAgICAgICAgICB0YWIubG9nKHN0YXRzLnRvU3RyaW5nKHtcbiAgICAgICAgICAgICAgY29sb3JzOiB0cnVlLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChlcnIpIHJldHVybiBvbmNlUmVqZWN0KGVycik7XG4gICAgICAgICAgaWYgKCF3YXRjaCAmJiBzdGF0cy5oYXNFcnJvcnMoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG9uY2VSZWplY3QobmV3IEVycm9yKGBDb21waWxhdGlvbiBlcnJvcnMgaW4gdGhlIG1haW4gcHJvY2VzczogJHtzdGF0cy50b1N0cmluZygpfWApKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gb25jZVJlc29sdmUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHdhdGNoKSB7XG4gICAgICAgICAgdGhpcy53YXRjaGVycy5wdXNoKGNvbXBpbGVyLndhdGNoKHt9LCBjYikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbXBpbGVyLnJ1bihjYik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgY29tcGlsZVJlbmRlcmVycyA9IGFzeW5jICh3YXRjaCA9IGZhbHNlKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzLCBtYXgtbGVuXG4gICAgYXdhaXQgYXN5bmNPcmEoJ0NvbXBpbGluZyBSZW5kZXJlciBUZW1wbGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgdGhpcy5ydW5XZWJwYWNrKFxuICAgICAgICBhd2FpdCB0aGlzLmdldFJlbmRlcmVyQ29uZmlnKHRoaXMuY29uZmlnLnJlbmRlcmVyLmVudHJ5UG9pbnRzKSxcbiAgICAgICk7XG4gICAgICBpZiAoIXdhdGNoICYmIHN0YXRzLmhhc0Vycm9ycygpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29tcGlsYXRpb24gZXJyb3JzIGluIHRoZSByZW5kZXJlcjogJHtzdGF0cy50b1N0cmluZygpfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBlbnRyeVBvaW50IG9mIHRoaXMuY29uZmlnLnJlbmRlcmVyLmVudHJ5UG9pbnRzKSB7XG4gICAgICBpZiAoZW50cnlQb2ludC5wcmVsb2FkKSB7XG4gICAgICAgIGF3YWl0IGFzeW5jT3JhKGBDb21waWxpbmcgUmVuZGVyZXIgUHJlbG9hZDogJHtlbnRyeVBvaW50Lm5hbWV9YCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGF3YWl0IHRoaXMucnVuV2VicGFjayhcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0UHJlbG9hZFJlbmRlcmVyQ29uZmlnKGVudHJ5UG9pbnQsIGVudHJ5UG9pbnQucHJlbG9hZCEpLFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxhdW5jaERldlNlcnZlcnMgPSBhc3luYyAobG9nZ2VyOiBMb2dnZXIpID0+IHtcbiAgICBhd2FpdCBhc3luY09yYSgnTGF1bmNoIERldiBTZXJ2ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGFiID0gbG9nZ2VyLmNyZWF0ZVRhYignUmVuZGVyZXJzJyk7XG5cbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRoaXMuZ2V0UmVuZGVyZXJDb25maWcodGhpcy5jb25maWcucmVuZGVyZXIuZW50cnlQb2ludHMpO1xuICAgICAgY29uc3QgY29tcGlsZXIgPSB3ZWJwYWNrKGNvbmZpZyk7XG4gICAgICBjb25zdCBzZXJ2ZXIgPSB3ZWJwYWNrRGV2TWlkZGxld2FyZShjb21waWxlciwge1xuICAgICAgICBsb2dnZXI6IHtcbiAgICAgICAgICBkZWJ1ZzogdGFiLmxvZy5iaW5kKHRhYiksXG4gICAgICAgICAgbG9nOiB0YWIubG9nLmJpbmQodGFiKSxcbiAgICAgICAgICBpbmZvOiB0YWIubG9nLmJpbmQodGFiKSxcbiAgICAgICAgICBlcnJvcjogdGFiLmxvZy5iaW5kKHRhYiksXG4gICAgICAgICAgd2FybjogdGFiLmxvZy5iaW5kKHRhYiksXG4gICAgICAgIH0sXG4gICAgICAgIHB1YmxpY1BhdGg6ICcvJyxcbiAgICAgICAgaG90OiB0cnVlLFxuICAgICAgICBoaXN0b3J5QXBpRmFsbGJhY2s6IHRydWUsXG4gICAgICAgIHdyaXRlVG9EaXNrOiB0cnVlLFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuICAgICAgYXBwLnVzZShzZXJ2ZXIpO1xuICAgICAgYXBwLnVzZSh3ZWJwYWNrSG90TWlkZGxld2FyZShjb21waWxlcikpO1xuICAgICAgdGhpcy5zZXJ2ZXJzLnB1c2goYXBwLmxpc3Rlbih0aGlzLnBvcnQpKTtcbiAgICB9KTtcblxuICAgIGF3YWl0IGFzeW5jT3JhKCdDb21waWxpbmcgUHJlbG9hZCBTY3JpcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBlbnRyeVBvaW50IG9mIHRoaXMuY29uZmlnLnJlbmRlcmVyLmVudHJ5UG9pbnRzKSB7XG4gICAgICAgIGlmIChlbnRyeVBvaW50LnByZWxvYWQpIHtcbiAgICAgICAgICBjb25zdCBjb25maWcgPSBhd2FpdCB0aGlzLmdldFByZWxvYWRSZW5kZXJlckNvbmZpZyhcbiAgICAgICAgICAgIGVudHJ5UG9pbnQsXG4gICAgICAgICAgICBlbnRyeVBvaW50LnByZWxvYWQhLFxuICAgICAgICAgICk7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGFiID0gbG9nZ2VyLmNyZWF0ZVRhYihgJHtlbnRyeVBvaW50Lm5hbWV9IC0gUHJlbG9hZGApO1xuICAgICAgICAgICAgY29uc3QgW29uY2VSZXNvbHZlLCBvbmNlUmVqZWN0XSA9IG9uY2UocmVzb2x2ZSwgcmVqZWN0KTtcblxuICAgICAgICAgICAgdGhpcy53YXRjaGVycy5wdXNoKHdlYnBhY2soY29uZmlnKS53YXRjaCh7fSwgKGVyciwgc3RhdHMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHN0YXRzKSB7XG4gICAgICAgICAgICAgICAgdGFiLmxvZyhzdGF0cy50b1N0cmluZyh7XG4gICAgICAgICAgICAgICAgICBjb2xvcnM6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIG9uY2VSZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG9uY2VSZXNvbHZlKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYWxyZWFkeVN0YXJ0ZWQgPSBmYWxzZTtcblxuICBhc3luYyBzdGFydExvZ2ljKCk6IFByb21pc2U8ZmFsc2U+IHtcbiAgICBpZiAodGhpcy5hbHJlYWR5U3RhcnRlZCkgcmV0dXJuIGZhbHNlO1xuICAgIHRoaXMuYWxyZWFkeVN0YXJ0ZWQgPSB0cnVlO1xuXG4gICAgYXdhaXQgZnMucmVtb3ZlKHRoaXMuYmFzZURpcik7XG5cbiAgICBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKHRoaXMubG9nZ2VyUG9ydCk7XG4gICAgdGhpcy5sb2dnZXJzLnB1c2gobG9nZ2VyKTtcbiAgICBhd2FpdCB0aGlzLmNvbXBpbGVNYWluKHRydWUsIGxvZ2dlcik7XG4gICAgYXdhaXQgdGhpcy5sYXVuY2hEZXZTZXJ2ZXJzKGxvZ2dlcik7XG4gICAgYXdhaXQgbG9nZ2VyLnN0YXJ0KCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iXX0=